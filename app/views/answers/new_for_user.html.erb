<% content_for :main do %>
<style>
    .dados-ok {
        color: gold;
        animation: blinker .8s linear infinite;
    }
    .dados-erro {
        color: red;
        animation: blinker 1s linear infinite;
    }
    @keyframes blinker {  
        50% { opacity: 0.0; }
    }
    body {
        background: #582985;
        background-image: url('/assets/FE3.png');
        color: #fff;
    }
    .container {
        text-transform: uppercase;
        font-weight: bolder;
    }
    h1 {
        text-shadow: -.05em -.02em #885c59;
        font-size: 2.4em;
        color: #00a99d;
        opacity: .6;
        text-align: center;
        font-family: ProximaNovaSoft-Bold;
        transform: rotate(-2deg);
    }
    h2 {
        text-align: justify;
        font-size: 1em;
        font-weight:  bolder;
        margin: 2em 0 1.5em 0;
        color: #fff;
    }
    .conteudo {
        margin: 0 auto;
    }
    .question {
        display: flex;
        align-items: center;
        margin-bottom: 2em;
    }
    .btn-1-inv {
        opacity: .8;
        margin: 2em auto;
        display: table;
        width: 40ch;
        max-width: 100%;
        display: block;
    }
    .answer {
        margin-right: .8em;
    }
    .answer input {
        display: none;
    }
    .answer label {
        font-size: 0;
    }
    .answer>input+label:after {
        content: "";
        background-image: url("/assets/cb0.svg");
        background-size: cover;
        width: 1.5rem;
        height: 1.5rem;
        display: inline-block;
    }
    .answer>input:checked+label:after {
        background-image: url("/assets/cb1.svg");
    }
    @media screen and (min-width: 500px) {
        h1 {
            font-size: 3.5em;
        }
    }
    @media screen and (min-width: 992px) {
        h1 {
            font-size: 5em;
        }
        h2 {
            text-align: center;
        }
    }
    @media screen and (min-width: 1200px) {
        h1 {
            font-size: 7em;
        }
        h2 {
            font-size: 1em;
        }
    }
</style>
<% end %>

<% content_for :main do %>
    <div class="container">
        <h1>O que é importante pra você?</h1>
        <div class="conteudo">
            <h2>Essas são as perguntas que fizemos aos candidatos e candidatas. Para encontrar a sua candidatura ideal, precisamos que você marque todas as perguntas em que você faz questão que elas ou eles tenham respondido positivamente.</h2>
        </div>


        <% @current_user.answers.sort{|a,b| a.question_id-b.question_id }.each do |answer| %>
        <div class="question">
            <div class="answer">
                <input type="checkbox" id="question-<%= answer.question_id %>" answer-id="<%= answer.id %>" <%= "checked" if answer.weight == 2 %> >
                <label for="question-<%= answer.question_id %>">Sim</label>
            </div>
            <span class="question-title">
                <%= answer.question.afirmative||answer.question.text %>
            </span>            
        </div>
        <div class="alert alert-danger invisivel" id="alert">
          <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
          <div></div>
        </div>
        <% end %>
        <%= link_to "Encontrar candidaturas", user_matchup_path(@current_user), {class: "btn btn-1-inv"} %>
    </div>
<% end %>


<% content_for :menu_logged do %>
    <li><%= link_to "Perfil", edit_user_path(session[:user_id]), {class: "dropdown-item"} %>
<% end %>

<% content_for :scripts do %>
<script>
    var UserCall = function(restUrl, tokenName, token) {
        var retorno = {
            _url: restUrl + "/"
            , _tokenName: tokenName
            , _token: token
            , bindElement: function ( elements, event ) {
                $(elements).on(event, function() {
                    var div = $(this).parent().parent()
                        divErro = div.next();
                    checkbox = $(this);
                    checkbox.attr("disabled", "disabled");
                    dados = {
                        weight: checkbox.prop("checked")?2:0
                    }
                    dados[retorno._tokenName] = retorno._token;
                    divErro.addClass("invisivel")
                    div.removeClass("dados-erro");
                    $.ajax({
                        url: retorno._url + checkbox.attr("answer-id")
                        , contentType: "application/json"
                        , method: "PUT"
                        , data: JSON.stringify (dados)
                        , success: function(dados) {
                            div.addClass("dados-ok");
                            window.setTimeout(function(){
                                div.removeClass("dados-ok");
                            }, 1000);
                            checkbox.removeAttr("disabled");
                        }
                        , error: function(dados) {
                            div.addClass("dados-erro");
                            checkbox.removeAttr("disabled");
                            divErro.removeClass("invisivel")
                            var msg;
                            if (dados.status == 0)
                                msg = "Não foi possível completar a operação, erro de comunicação com o site, por favor recarregue a página.";
                            else {
                                msg = "Erro de processamento";
                                checkbox.prop("checked",! checkbox.prop("checked"));
                            }
                            divErro.children("div").text(msg);
                        }
                    });
                });
            }
        };
        return retorno;
    };

    
    (function(){
        var userCall = UserCall( "<%= user_answers_path(@current_user) %>", "<%= request_forgery_protection_token.to_s %>", "<%= form_authenticity_token %>" );

        userCall.bindElement(".answer input", "change");
    })();

</script>
<% end %>